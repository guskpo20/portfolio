---
import Layout from "../components/Layout.astro";
import type { CollectionEntry } from "astro:content";

type Props = CollectionEntry<"portfolio">["data"] & {
    lang: "es" | "en";
};

const {
    title_es,
    title_en,
    description_es,
    description_en,
    category,
    pubDate,
    updatedDate,
    heroImage,
    tags,
    lang,
} = Astro.props;

const title = lang === "es" ? title_es : title_en;
const description = lang === "es" ? description_es : description_en;

// --- SEO Logic ---

const schema = {
    "@context": "https://schema.org",
    "@type": "CreativeWork",
    headline: title,
    description: description,
    author: {
        "@type": "Person",
        name: "Gustavo Keymetlian",
        url: "https://tavo.work",
    },
    datePublished: pubDate.toISOString(),
    image: new URL(heroImage, Astro.site).toString(),
    mainEntityOfPage: {
        "@type": "WebPage",
        "@id": new URL(Astro.url.pathname, Astro.site).toString(),
    },
};

const currentPath = Astro.url.pathname;
const slug = currentPath.split("/").pop();

const alternateURLs =
    lang === "es"
        ? { en: `/en/portfolio/${slug}` }
        : { es: `/portfolio/${slug}` };
---

<Layout
    title={`${title} | Portfolio`}
    description={description}
    lang={lang}
    schema={schema}
    alternateURLs={alternateURLs}
>
    <!-- Project Header -->
    <section class="project-header">
        <div class="container">
            <a
                href={lang === "es" ? "/portfolio" : "/en/portfolio"}
                <div
                class="header-content"
            >
                <a
                    href={lang === "es" ? "/portfolio" : "/en/portfolio"}
                    class="back-link"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        ><path d="m15 18-6-6 6-6"></path></svg
                    >
                    {
                        lang === "es"
                            ? "Volver al Portfolio"
                            : "Back to Portfolio"
                    }
                </a>
                <span class="category-badge">{category}</span>
                <h1 class="heading-text-typo">{title}</h1>
                <p class="description">{description}</p>
                <div class="meta">
                    {tags?.map((tag) => <span class="tech-tag">#{tag}</span>)}
                </div>
            </a>
        </div>
    </section>

    <!-- Hero Image (Full Width or contained) -->
    <section class="project-hero-image container">
        <img
            src={heroImage}
            alt={title}
            transition:name={`project-image-${slug}`}
        />
    </section>

    <!-- Content -->
    <article class="container project-content">
        <div class="prose">
            <slot />
        </div>
    </article>
</Layout>

<style lang="scss">
    @import "../styles/variables.scss";

    .project-header {
        // Ensure this clears the fixed navbar
        padding-top: 140px;
        padding-bottom: 3rem;
        background: linear-gradient(to bottom, #f9f9f9, #fff);
        text-align: center;
        position: relative;
        z-index: 1;

        // Target the container directly for flex alignment
        // > .container {
        //     display: flex;
        //     flex-direction: column;
        //     align-items: flex-start; // Align children (like back-link) to left
        // }

        .header-content {
            width: 100%; // Ensure it takes full width to center its internal text
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center; /* Center text stack */
            position: relative; /* Ensure context */
        }

        .back-link {
            display: flex; /* Flex behavior, block-level in flex container */
            align-items: center;
            gap: 0.5rem;
            color: #666;
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 2rem;
            transition: color 0.2s;
            align-self: flex-start; /* Push ONLY the button to the left edge of the 800px content */

            @media (min-width: 768px) {
                position: relative;
                top: auto;
                left: auto;
                /* align-self: flex-start is already set */
                margin-left: 0;
            }

            &:hover {
                color: $base-color;
            }

            svg {
                transition: transform 0.2s;
            }

            &:hover svg {
                transform: translateX(-3px);
            }
        }

        .category-badge {
            display: inline-block;
            background: $base-color;
            color: #fff;
            padding: 0.25rem 0.75rem;
            border-radius: 99px;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        h1 {
            font-size: 3rem;
            color: $base-color;
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .description {
            font-size: 1.25rem;
            color: #666;
            max-width: 700px;
            margin: 0 auto 1.5rem;
            line-height: 1.6;
        }

        .meta {
            display: flex;
            gap: 0.8rem;
            justify-content: center;
            flex-wrap: wrap;

            .tech-tag {
                color: #555;
                font-size: 0.9rem;
                background: #eee;
                padding: 4px 12px;
                border-radius: 20px;
            }
        }
    }

    .project-hero-image {
        margin-bottom: 4rem;
        margin-top: -2rem; // Slight overlap if desired, or 0
        position: relative;
        z-index: 2;

        img {
            width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
            display: block; // Remove inline alignment gaps
        }
    }

    .project-content {
        max-width: 800px !important; // Match header width for reading
        padding-bottom: 5rem;
    }

    /* Reuse some prose styles or define new ones */
    .prose {
        :global(h2) {
            font-size: 2rem;
            margin-top: 3rem;
            margin-bottom: 1rem;
            color: $base-color;
            font-family: $font-family-heading;
        }
        :global(h3) {
            font-size: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 0.8rem;
            color: $base-color;
            font-weight: 600;
        }
        :global(h4) {
            font-size: 1.3rem;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 600;
        }
        :global(p) {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #333;
            margin-bottom: 1.5rem;
        }

        :global(ul),
        :global(ol) {
            margin-bottom: 1.5rem;
            padding-left: 2rem; // Increased alignment spacing

            :global(li) {
                margin-bottom: 0.5rem;
                color: #333;
                line-height: 1.8; // Match p line-height
                padding-left: 0.5rem;
                font-size: 1.1rem; // Match p font-size
            }

            // Nested lists
            :global(ul) {
                margin-top: 0.5rem;
                margin-bottom: 0.5rem;
                padding-left: 2rem;
                list-style-type: circle;
            }

            :global(ol) {
                margin-top: 0.5rem;
                margin-bottom: 0.5rem;
                padding-left: 2rem;
                list-style-type: decimal;
            }
        }

        :global(pre) {
            background-color: #f4f4f4;
            padding: 2rem; // More padding on all sides
            border-radius: 8px;
            overflow-x: auto;
            margin-bottom: 2rem;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        :global(strong) {
            color: $base-color;
            font-weight: 600;
        }
    }

    @media (max-width: 768px) {
        .project-header {
            padding-top: 100px; // Adjust for smaller mobile header if needed

            h1 {
                font-size: 2.2rem;
            }
        }
    }
</style>
